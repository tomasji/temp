machine:
    services:
        - docker

dependencies:
    cache_directories:
        - "~/docker"
    override:
        - docker info
        - docker login -e saldock@salsitasoft.com -u $DOCKER_USER -p $DOCKER_PASSWORD docker.salsitasoft.com
        - if [[ -e ~/docker/image.tar ]]; then docker load --input ~/docker/image.tar; fi
        - docker run docker.salsitasoft.com/shishito:0.1 /usr/bin/true
        - mkdir -p ~/docker; docker save docker.salsitasoft.com/shishito:0.1 > ~/docker/image.tar

test:
    override:
        - docker run -d -p 9200:9200 docker.salsitasoft.com/shishito:0.1; sleep 10
        - curl --retry 10 --retry-delay 5 -v http://localhost:9200
